// nextflow.config
params {
    // Basic parameters
    species = "Homo sapiens"
    outdir = "results"
    
    // Data source selection (flexible - easily enable/disable sources)
    sources = ['reactome', 'string', 'bigg', 'trrust', 'reactome_fi', 'intact', 'omnipath']
    
    // Processing options
    uncompartmentalize = true
    drop_cofactors = true
    expand_identifiers = true    
}

// Process defaults
process {
    
    memory = 8.GB
    cpus = 2
    time = 2.h
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 1
    
    // Better error reporting for Docker issues
    beforeScript = '''
        echo "Process: ${task.process}"
        echo "Working directory: ${task.workDir}"
    '''
    
    // Resource overrides for heavy processes
    withName: 'CREATE_CONSENSUS' {
        memory = 64.GB
        cpus = 16
        time = 3.h
        errorStrategy = 'ignore'  // For testing - can continue without consensus
    }
    
    withName: 'INTEGRATE_STRING_DB' {
        memory = 32.GB
        time = 2.h
    }
    
    withName: 'EXPORT_DISTANCES' {
        memory = 32.GB
        cpus = 8
        time = 2.h
        errorStrategy = 'ignore'  // For testing - distances are optional
    }
    
    withName: 'FILTER_HPA_COMPARTMENTS' {
        memory = 16.GB
        time = 1.h
    }
    
    withName: 'INTEGRATE_BIGG' {
        memory = 16.GB
        time = 1.h
    }
    
    withName: 'INTEGRATE_REACTOME' {
        memory = 16.GB
        time = 1.h
    }
    
    withName: 'INTEGRATE_INTACT' {
        memory = 16.GB
        time = 1.h
    }
}

// Execution profiles
profiles {
    
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        docker.temp = 'auto'
        
        process {
            container = "us-west1-docker.pkg.dev/shackett/napistu-images/napistu-base:latest"
        }
    }
    
    docker_arm64 {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g) -v /Users/sean/Desktop/GITHUB/napistu/lib/napistu-nextflow:/workspace'
        docker.temp = 'auto'
        
        process {
            container = "us-west1-docker.pkg.dev/shackett/napistu-images/napistu-base:latest-multiplatform"
        }
    }
    
    // Test pathway profile - for simple test workflow
    test_pathway {
        params {
            species = "Homo sapiens"
            outdir = "test_pathway_results"
            drop_cofactors = true
            test_data_path = "/workspace/test_data"  // Use the mounted path
        }
        
        env {
            TEST_DATA_PATH = params.test_data_path
        }
        
        process {
            memory = 2.GB
            cpus = 1
            time = 30.min
            errorStrategy = 'retry'
            maxRetries = 1
            
            withName: 'INTEGRATE_TEST_REACTOME' {
                memory = 4.GB
                time = 30.min
            }
            
            withName: 'EXPORT_IGRAPH' {
                memory = 4.GB
                time = 15.min
            }
            
            withName: 'EXPORT_DISTANCES' {
                memory = 8.GB
                cpus = 2
                time = 30.min
            }
            
            withName: 'DROP_COFACTORS' {
                memory = 4.GB
                time = 15.min
            }
        }
    }
    
    // Test profile - minimal resources for quick testing
    test {
        params {
            sources = ['reactome']
            outdir = "test_results"
            uncompartmentalize = false
            drop_cofactors = false
        }
        
        process {
            memory = 2.GB
            cpus = 1
            time = 30.min
            errorStrategy = 'ignore'
        }
    }
}